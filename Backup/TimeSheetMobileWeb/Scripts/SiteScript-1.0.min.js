function TSM_OpenTask(c) { var d = $("[data-row-from=" + c + "]"); var b = d.attr("data-button-selection"); row_choice_ViewList.Select("property_group_" + b); $("#rowsTitle").text(TSM_DetailTitle(b)); var a = d.attr("data-row-from"); $("#basedetail").data("chosen-row", a); TSM_CopyFromRow(a) } function TSM_SaveTask() { var a = $(this); if (!$("#detailform").validate().form()) { a.cancel = true; return } TSM_ensurePositive(); TSM_CopyToRow($("#basedetail").data("chosen-row")); TSM_UpdateMainLayout(); TSM_formDirty(true) } (function () { var b = "_configuration_"; var c = "_user_"; var d = "_task_"; var a = "_row_"; var f = "_approval_"; var e = "_updated_"; window.configuration = { show: function () { var g = getCookie(b, true); alert("task view: " + g[d] + " row view: " + g[a] + " approval view: " + g[f] + " user: " + g[c] + " updated: " + g[e]) }, set: function (g, i, j) { var h = getCookie(b, true); h[d] = i || ""; h[a] = g || ""; h[f] = j || ""; h[e] = "true"; setCookie(b, h, true, 365) }, get: function () { var g = getCookie(b, true); return { task: g[d] || "", row: g[a] || "", approval: g[f] || ""} } } })(); function TSM_ChangePage(a, c, b) { var d = { cancel: false, action: b }; $("#" + a).trigger("gotoing", d); $("#" + a).trigger("goto", d) } function TSM_Return(b, d, e, a) { var c = { cancel: false, action: a }; $("#" + b).trigger(e + "ing", c); $("#" + b).trigger(e, c) } function TSM_LeaveTo(a, b, c) { var d = { cancel: false }; $("#" + b).trigger("leaveApplication", d); if (d.cancel) { return } window.location.href = a } function TSM_partialSubmit(jForm) { var target = $("#" + jForm.attr("data-ajax-target")); TSM.initPreloader("show"); $.post(jForm.attr("data-ajax-url"), jForm.serialize(), function (data) { target.html(data); $.validator.unobtrusive.reParse(target); TSM_initButtons(TSM_PageChangeOptions); var onComplete = jForm.attr("data-ajax-oncomplete") || null; if (onComplete != null) { onComplete = eval(onComplete); onComplete(data) } TSM.initPreloader("hide") }) } function TSM_jsonSubmit(jForm) { TSM.initPreloader("show"); $.post(jForm.attr("data-ajax-url"), jForm.serialize(), function (data) { var onComplete = jForm.attr("data-ajax-oncomplete") || null; if (onComplete != null) { onComplete = eval(onComplete); onComplete($.parseJSON(data)) } }, "text"); TSM.initPreloader("hide") } function TSM_formDirty(c, d) { d = d || "mainform"; var a = ($(".currtotalact").length != 0) && ($(".candelete").val() != "True") && ($(".approvalmode").val() != "True"); var e = $("#" + d); e.data("_dirty_", c); e.trigger("dirtychange", c); var b = ($(".currentperiodid").val() || "") == ""; var f = false; if ((!c) || f || a) { $(".csubmit-" + d).addClass("ui-disabled"); $(".fsubmit-" + d).addClass("ui-disabled") } else { $(".csubmit-" + d).removeClass("ui-disabled"); $(".fsubmit-" + d).removeClass("ui-disabled") } if (b || $(".canrecall").val() != "True") { $("#btnRecall").addClass("ui-disabled") } else { $("#btnRecall").removeClass("ui-disabled") } if (b || $(".candelete").val() != "True") { $("#btnDelete").addClass("ui-disabled") } else { $("#btnDelete").removeClass("ui-disabled") } if (b) { $("#btnRecallDelete").addClass("ui-disabled") } else { $("#btnRecallDelete").removeClass("ui-disabled") } $("#currstatusdisplay").text($(".currstatus").val()) } function TSM_formDelete(b) { b = b || "mainform"; var a = $(".innerRowsContainer").children().length == 0; if (a) { $(".csubmit-" + b).prop("disabled", true) } $(".fsubmit-" + b).prop("disabled", a) } function TSM_isFormDirty(a) { a = a || "mainform"; return $("#" + a).data("_dirty_") || false } function TSM_prepareDatePicker(f) { var c = null; var g = null; var e = f.attr("data-val-daterange-max") || ""; if (e != "") { g = new Date(parseInt(e)) } var d = f.attr("data-val-daterange-min") || ""; if (d != "") { c = new Date(parseInt(d)) } var h = f.attr("data-val-clientdynamicdaterange-max") || ""; var b = f.attr("data-val-clientdynamicdaterange-min") || ""; var j = f.attr("data-val-clientdynamicdaterange-mindelay") || ""; var l = f.attr("data-val-clientdynamicdaterange-maxdelay") || ""; if (h != "") { h = $.validator.takeDynamicValue(f[0], h); if (h != null) { h = jQuery.global.parseDate(h); if (!isNaN(h)) { if (l != "") { h = new Date(h.getTime() + parseInt(l)) } if (g != null) { if (h < g) { g = h } } else { g = h } } } } if (b != "") { b = $.validator.takeDynamicValue(f[0], b); if (b != null) { b = jQuery.global.parseDate(b); if (!isNaN(b)) { if (j != "") { b = new Date(b.getTime() + parseInt(j)) } if (c != null) { if (b > c) { c = b } } else { c = b } } } } var i = jQuery.global.parseDate(f.val()); var k = null; if (i == null || isNaN(i)) { i = null; k = new Date() } else { if (c != null && i < c) { i = c } if (g != null && i > g) { i = g } k = i } var a = $(".datapickerwidget"); a.datepicker("option", { minDate: c, maxDate: g, defaultDate: k, gotoCurrent: true }); a.datepicker("setDate", k) } function TSM_initButtons(a) { if ($(".datapickerwidget").length > 0) { $(".datapickerwidget").datepicker({ onSelect: function (c, b) { $("#dateinput").trigger("dateselected", c); history.back() } }); $("a.datepicker").click(function (c) { c.preventDefault(); c.stopImmediatePropagation(); if ($(this).hasClass("ui-disabled")) { return } $("#dateinput").data("_returnNode_", this); var d = $(this).attr("id"); d = d.substring(0, d.lastIndexOf("_")); var b = $("#" + d); TSM_prepareDatePicker(b); $.mobile.changePage("#dateinput", a) }) } $(".submit").click(function (c) { c.preventDefault(); c.stopImmediatePropagation(); if ($(this).hasClass("ui-disabled")) { return } jThis = $(this); var b = jThis.attr("data-action-confirm"); if (b && !window.confirm(b)) { return } var d = $("#" + jThis.attr("data-action-container")); d.val(jThis.attr("data-action-value")); var f = d.parents("form").first(); if (f.validate().form()) { TSM_partialSubmit(f) } }); $(".confirm").click(function (b) { b.preventDefault(); b.stopImmediatePropagation(); if ($(this).hasClass("ui-disabled")) { return } TSM_Return($(this).attr("data-button-target"), a, "confirm", b.target) }); $(".loadConfirm").click(function (c) { if (TSM_isFormDirty() && !window.confirm($(this).attr("data-leave-application"))) { c.preventDefault(); return } c.preventDefault(); c.stopImmediatePropagation(); if ($(this).hasClass("ui-disabled")) { return } jThis = $(this); var b = jThis.attr("data-action-confirm"); if (b && !window.confirm(b)) { return } var d = $("#" + jThis.attr("data-action-container")); d.val(jThis.attr("data-action-value")); var f = d.parents("form").first(); if (f.validate().form()) { TSM_partialSubmit(f) } }); $(".leaveApplication").click(function (b) { b.preventDefault(); b.stopImmediatePropagation(); if ($(this).hasClass("ui-disabled")) { return } TSM_LeaveTo($(this).attr("data-button-target"), $(this).attr("data-button-application")) }); $(".TimesheetId").click(function (b) { b.stopPropagation(); EnableApprove($(this).attr("data-button-target")) }); $(".TaskId").click(function (b) { b.stopPropagation(); EnableApprove($(this).attr("data-button-target")) }); $(".taskapprovals").click(function (b) { b.stopPropagation(); EnableTaskApprove() }) } var TSM_PageChangeOptions = null; $(document).ready(function () { TSM_initButtons(TSM_PageChangeOptions); $(".leaveapp").bind("click", function (e, data) { if (TSM_isFormDirty() && !window.confirm($(this).attr("data-leave-application"))) { e.preventDefault(); return } GotoUrl($(this).attr("data-target")) }); $(function () { $(".datepicker").datepicker() }); $(".updatelineclass").change(function () { var jThis = $(this); $(".currentlineclassid").val(jThis.find("option:selected").val()); $(".currentlineclassname").val(jThis.find("option:selected").text()); TSM_ConfirmAdd(true) }); $(".dynamictasks").change(function () { $(".currentassname").val($(this).find("option:selected").text()); $(".currentassid").val($(this).find("option:selected").val()); TSM_ConfirmAdd(true) }); $(".updatetasks").change(function () { TSM.initPreloader("show"); var jThis = $(".updatetasks"); if (jThis.val() == "-1") { $(".normalRows").hide(); $(".adminRows").show() } else { $(".adminRows").hide(); $(".normalRows").show() } $(".currentprojname").val(jThis.find("option:selected").text()); var data = $(".currentprojname").val(); var selectedid = jThis.val(); $.ajax({ cache: false, type: "POST", url: jThis.attr("data-action") + "?projectId=" + selectedid, async: "false", contentType: "application/json", success: function (data) { $("#assignmentsContainer").html(data); TSM_TasksOptionsCallback($(".dynamictasks")); TSM_ConfirmAdd(); $(".dynamictasks").change(function () { $(".currentassname").val($(this).find("option:selected").text()); $(".currentassid").val($(this).find("option:selected").val()); TSM_ConfirmAdd(true) }); TSM.initPreloader("hide") } }) }); $(".updatetimesheets").change(function () { var jForm = $("#periodform"); var target = $("#" + jForm.attr("data-ajax-target")); TSM.initPreloader("show"); var jForm = $("#periodform"); $.post(jForm.attr("data-ajax-url") + "?speriod=" + $(".updatetimesheets").val(), jForm.serialize(), function (data) { target.html(data); $.validator.unobtrusive.reParse(target); TSM_initButtons(TSM_PageChangeOptions); var onComplete = jForm.attr("data-ajax-oncomplete") || null; if (onComplete != null) { onComplete = eval(onComplete); onComplete() } TSM.initPreloader("hide") }) }); $(".updaterowview,  .updatetaskview").change(function () { TSM_View() }); TSM_ConfirmPeriod(true, null); TSM_View(); TSM_UpdateMainLayout(); $(".allrowsContainer").bind("itemChange", function (e, data) { if (data.ChangeType == "ItemCreated") { TSM_UpdateMainLayout(); TSM_formDirty(true) } else { if (data.ChangeType == "ItemDeleted") { TSM_UpdateMainLayout(); TSM_formDirty(true) } } }) }); $(document).ready(function (a) { if (a.target != undefined) { if (a.target.id == "taskselection") { TSM_TasksOptionsCallback($(".dynamictasks")); TSM_ConfirmAdd() } else { if (a.target.id == "periodselection") { TSM_PeriodsOptionsCallback($(".updatetimesheets")) } } } }); function TSM_TasksOptionsCallback(a) { if (a.length > 0) { if (a[0].options.length > 1) { a.removeClass("ui-disabled") } else { a.addClass("ui-disabled") } TSM_ConfirmAdd() } else { a.addClass("ui-disabled"); TSM_ConfirmAdd(); if ($("#RequiredProgectId option:selected").text() != "Choose project") { $(".rowlist").each(function () { var b = $(this); b.removeClass("ui-disabled") }); $("#" + $("#RequiredProgectId option:selected").text() + "_display").val("Top Level") } } } function TSM_ConfirmAdd(d) { var c = $(".dynamictasks").val(); var a = $(".updatelineclass").val(); var b = $("#RequiredProgectId").val(); if (c == "") { $(".rowlist").each(function () { $(this).addClass("ui-disabled") }); if (b == "-1") { $(".updatelineclass").addClass("ui-disabled") } else { $(".updatelineclass").removeClass("ui-disabled") } return } if (b == "-1") { $(".updatelineclass").addClass("ui-disabled") } else { $(".updatelineclass").removeClass("ui-disabled") } $(".rowlist").each(function () { var f = $(this); var e; if (b == "-1") { e = "p-" + c + "-" + f.attr("data-button-selection") } else { e = "p-" + c + "_" + a + "-" + f.attr("data-button-selection") } var g = "p-TopLevel_" + a + b + "-" + f.attr("data-button-selection"); if (((c || "") != "") && ($(".currentperiodid").val() != "")) { if ($(".dynamictasks option:selected").text() == "Top Level") { if ($("." + g).length == 0) { f.removeClass("ui-disabled") } else { f.addClass("ui-disabled") } } else { if ($("." + e).length == 0) { f.removeClass("ui-disabled") } else { f.addClass("ui-disabled") } } } else { f.addClass("ui-disabled") } }) } var TSM_CurrRowType = null; function TSM_PrepareRowType(a) { TSM_CurrRowType = $(a).attr("data-button-selection") || null; $(".currentrowtype").val(TSM_CurrRowType) } function TSM_PeriodsOptionsCallback(a) { a.removeClass("ui-disabled"); $("#btnConfirmPeriod").prop("disabled", false); a.selectmenu("refresh"); TSM_NewPeriod() } function TSM_NewPeriod() { var a = $(".updatetimesheets option:selected").text() || ""; if (a == "") { a = $(".updatetimesheets").attr("data-novalue-message") } $(".newtimesheet").text(a) } function TSM_ConfirmPeriod(f, e) { var a = $(".updatetimesheets option:selected").text() || ""; if (a == "") { a = $("#periodstart").val() } if (e != null) { a = "" } $("#btnAdd").prop("disabled", a == ""); $("#btnRecallDelete").prop("disabled", true); var g = $(".updatetimesheets"); if (a == "") { $("#btnRecallDelete").prop("disabled", true); $(".currenttimesheet").text(g.attr("data-novalue-message")); $(".currentperiodid").val(""); $(".currentperiodstart").val(""); $(".currentperiodstop").val(""); $(".allTimesheetsEdit").empty(); $(".currentperiodSet").val($(".updatetimesheets").val()); TSM_PrepareDays("", ""); TSM_formDirty(false); if (f == null) { $("#allTimesheetsEdit").empty() } } else { $("#btnRecallDelete").prop("disabled", false); var d = $("#indexPeriod").text(); var c = $("#periodid").val(); if (d != undefined) { var b = d.replace("(", "").replace(")", "").split(" "); $(".currenttimesheet").text(d); $(".currentperiodid").val(c); $(".currentperiodstart").val(b[0]); $(".currentperiodstop").val(b[2]) } TSM_PrepareDays($("#periodstart").val(), $("#periodend").val()); $(".currentperiodSet").val($(".updatetimesheets").val()); if (f == null) { TSM_partialSubmit($("#periodform")) } } } function TSM_ConfirmPeriodCallBack(a) { var b = a; TSM_formDirty(false); TSM_UpdateMainLayout(); $(".currstatus-d").text($(".currstatus").val() || "") } function TSM_UpdateMainLayout() { } function TSM_View() { var a = configuration.get(); var b = ""; var d = ""; var c = ""; if (a.task) { b = $('.updatetaskview option[value="' + a.task + '"]').text() } if (a.row) { d = $('.updaterowview option[value="' + a.row + '"]').text() } if (a.approval) { c = $('.updateapprovalview option[value="' + a.approval + '"]').text() } if (b) { $(".currenttaskview").text(b) } if (d) { $(".currentrowview").text(d) } if (c) { $(".currentapprovalview").text(c) } if (window._rowViewDescriptions_) { $(".rowViewDescription-o").text(window._rowViewDescriptions_[a.row] || ""); $(".rowViewDescription").text(window._rowViewDescriptions_[$(".updaterowview").val()] || "") } if (window._taskViewDescriptions_) { $(".taskViewDescription-o").text(window._taskViewDescriptions_[a.task] || ""); $(".taskViewDescription").text(window._taskViewDescriptions_[$(".updatetaskview").val()] || "") } if (window._approvalViewDescriptions_) { $(".approvalViewDescriptions-o").text(window._approvalViewDescriptions_[a.task] || ""); $(".approvalViewDescriptions").text(window._approvalViewDescriptions_[$(".updateapprovalview").val()] || "") } } function TSM_ConfirmView() { current = configuration.get(); var c = $(".updaterowview"); var a = $(".updatetaskview"); var b = $(".updateapprovalview"); if (c.length > 0) { current.row = c.val() } var a = $(".updatetaskview"); var b = $(".updateapprovalview"); configuration.set(current.row, current.task, current.approval); GotoUrl($("#periodform").attr("data-ajax-url")) } function TSM_startAddRow(b) { var a = $(b).attr("data-button-selection") || null; $(".currentrowtype").val(a); TSM_jsonSubmit($("#rowRequest")) } function TSM_CompleteAddRow(d) { d.ProjectId = $("#RequiredProgectId").val(); TSM_formDirty(true); var c = $(".currentrowtype").val(); var j = TSM_ChooseTemplate(c); var e = $(".innerRowsContainer"); var i = e.attr("data-rows-prefix"); var f = null; var a = e.children(); if (a.length > 0) { f = MvcControlsToolkit_SortableList_AddNewChoice(i, j, a[0]).first() } else { f = MvcControlsToolkit_SortableList_AddNewChoice(i, j).first() } var h = f.attr("id"); var g = h.lastIndexOf("_"); h = h.substring(0, g); TSM_CopyObjectToRow(f, d, h); var b = $("#RequiredProgectId").val(); if (b != "-1") { if (d.CustomFieldItems != undefined) { $.ajax({ cache: false, type: "POST", url: "Timesheet/CustomFields", async: "false", contentType: "application/json", dataType: "json", data: JSON.stringify(d.CustomFieldItems), success: function (k) { $("#" + h).empty(); $("#" + h).html(k); $("#" + h).find("[class=datatype]").each(function () { var m = $(this).val(); var l = $(this).attr("field") }); if (k.AssignementName == "Top Level") { $(".p-guid-container").removeClass("p-guid-container").addClass("p-TopLevel_" + k.LineClass.Id + k.ProjectId + "-" + c) } else { $(".p-guid-container").removeClass("p-guid-container").addClass("p-" + k.AssignementId + "_" + k.LineClass.Id + "-" + c) } $(".p-project-container").removeClass("p-project-container").addClass("p-" + k.ProjectId + k.AssignementName + "-" + c); TSM.init() }, error: function (m, l, k) { if (m.readyState == 4) { $("#" + h).empty(); $("#" + h).html(m.responseText); $("#" + h).find("[class=datatype]").each(function () { var o = $(this).val(); var n = $(this).attr("field"); $("#" + h).find("[class=datatype]").each(function () { var q = $(this).val(); var p = $(this).attr("field"); if (p == "Lookup") { p = $(this).attr("lookuptable"); q = "Lookup" } $(".detailTBCS[name=" + p + "]").each(function () { var r = $(this); r.hide(); if (r.attr("class").indexOf(q) >= 0) { if (q == "Date") { if ($("#" + h).find("[class=" + p + "][valuetype=" + q + "]").val() != "") { r.val($("#" + h).find("[class=" + p + "][valuetype=" + q + "]").val().split(" ")[0]) } else { r.val("No Date") } } else { if (q == "Flag") { if ($("#" + h).find("[class=" + p + "][valuetype=" + q + "]").val() == "True") { r[0].children[0].checked = true; r[0].children[1].checked = false } else { if ($("#" + h).find("[class=" + p + "][valuetype=" + q + "]").val() == "False") { r[0].children[0].checked = false; r[0].children[1].checked = true } else { if ($("#" + h).find("[class=" + p + "][valuetype=" + q + "]").val() == "") { r[0].children[0].checked = false; r[0].children[1].checked = false } } } } else { if (q == "Lookup") { r.html($("#" + h).find("." + p + "_display").html()); if ($("#" + h).find("[class=" + p + "][valuetype=Lookupid]").val() != undefined && $("#" + h).find("[class=" + p + "][valuetype=Lookupid]").val() != "") { $("." + p + "lkp").val($("#" + h).find("[class=" + p + "][valuetype=Lookupid]").val()) } } else { r.val($("#" + h).find("[class=" + p + "][valuetype=" + q + "]").val()) } } } r.show() } else { r.empty() } }) }) }); if (d.AssignementName == "Top Level") { $(".p-guid-container").removeClass("p-guid-container").addClass("p-TopLevel_" + d.LineClass.Id + d.ProjectId + "-" + c) } else { $(".p-guid-container").removeClass("p-guid-container").addClass("p-" + d.AssignementId + "_" + d.LineClass.Id + "-" + c) } $(".p-project-container").removeClass("p-project-container").addClass("p-" + d.ProjectId + d.AssignementName + "-" + c); TSM.init() } } }) } } else { $(".p-guid-container").removeClass("p-guid-container").addClass("p-" + d.AssignementId + "-" + c); $(".p-project-container").removeClass("p-project-container").addClass("p-" + d.ProjectId + d.AssignementName + "-" + c); TSM.init() } TSM.init(); CloseDialog("#taskselection"); $("#RequiredProgectId").val("-100"); $("#assignments").val("-100") } function TSM_GetRowValue(b, a, c) { if (c == null) { return } b = a + "_" + b; return $("#" + b).val() } function TSM_SetRowValue(d, j, h) { if (h == null) { return } d = j + "_" + d; var c = document.getElementById(d); if (c == null) { return } var k = typeof (h); if (k == "boolean") { $(c).val(h ? "True" : "False"); $(d + "_display").text(h ? TSM_Checked : TSM_UnChecked) } else { var e = -1; var j = ""; var f = ""; var b = ""; var i = ""; var l = $("#" + d + "_display"); var a = $(c); var g = l.attr("data-format") || null; if (g == null) { if (k == "string") { e = MvcControlsToolkit_DataType_String } else { if (k == "number") { if (!isNaN(parseInt(h * 1)) && parseInt(h * 1) === h) { e = MvcControlsToolkit_DataType_Int } else { e = MvcControlsToolkit_DataType_Float } } else { if (h instanceof Date) { e = MvcControlsToolkit_DataType_DateTime } } } } else { g = $.parseJSON(g); e = g.type; j = g.prefix; f = g.postfix; b = g.nullstring; i = g.format; if (k == "string" && e > 0) { h = MvcControlsToolkit_Parse(h, e) } } if (l.length > 0) { l.text(MvcControlsToolkit_FormatDisplay(h, i, e, j, f, b)) } if (a.length > 0) { a.val(MvcControlsToolkit_Format(h, "", e, "", "")) } } } function TSM_CopyObjectToRow(b, d, e) { for (var c in d) { if (c == "AssignementName") { var a = d[c] || null; if (a != null) { TSM_SetRowValue(c, e, d[c] + " " + d.LineClass.Name); $(e).find(".currentlineclassid").val(d.LineClass.Id); continue } } if (c == "LineClass") { $("#" + e + "_LineClass_Id").val(d.LineClass.Id); $("#" + e + "_LineClass_Name").val(d.LineClass.Name) } if (c == "DayTimes") { var a = d[c] || null; if (a != null) { for (var f = 0; f < a.length; f++) { TSM_SetRowValue(c + "_" + f + "_", e, a[f]) } } } TSM_SetRowValue(c, e, d[c]) } } function TSM_CopyToRow(a) { $("#" + a + "_Container").addClass("dirty"); $(".detailBoolean").each(function () { var b = $(this); var d = b.prop("checked"); var c = b.attr("id"); $("#" + a + "_" + c).val(d ? "True" : "False"); $("#" + a + "_" + c + "_display").text(d ? TSM_Checked : TSM_UnChecked) }); $(".detailTB").each(function () { var c = $(this); var d = c.attr("id"); if ((c.attr("data-element-type") || "") != "") { d = d.substring(0, d.lastIndexOf("_")); c = $("#" + d) } tname = "#" + d.substring(0, d.length - 3) + "_Total_" + d.substring(d.length - 2, d.length - 1); var b; if (!isNaN(parseFloat(c.val()))) { b = parseFloat(c.val()) } else { b = 0 } var f; var e; if (d.indexOf("plh") == -1 && d.indexOf("DayTime") != -1) { if (!isNaN(parseFloat($(tname).text()))) { e = parseFloat($(tname).text()) } else { e = 0 } if (!isNaN(parseFloat($("#allTotal").text()))) { f = parseFloat($("#allTotal").text()) } else { f = 0 } var g = TSM_GetRowValue(d, a, c.val()); if (isNaN(parseFloat(g))) { g = 0 } TSM_SetRowValue(d, a, b); if (!isNaN(parseFloat(g)) && !isNaN(parseFloat(c.val()))) { $(tname).text((e + parseFloat(c.val()) - parseFloat(g)).toFixed(2)); $("#allTotal").text((f + parseFloat(c.val()) - parseFloat(g)).toFixed(2)) } else { if (isNaN(parseFloat(c.val()))) { $(tname).text(b.toFixed(2)); $("#allTotal").text((f - parseFloat(g)).toFixed(2)) } else { if (isNaN(parseFloat(g))) { $(tname).text((e + b).toFixed(2)); $("#allTotal").text((f + b).toFixed(2)) } else { $(tname).text((e + b).toFixed(2)); $("#allTotal").text((f + b).toFixed(2)) } } } } else { TSM_SetRowValue(d, a, c.val()) } }); $(".detailTBCS").each(function () { var d = $(this); var b = d.attr("name"); var c = d.attr("valuetype"); if (c == "Date") { $("#" + a).find("[class=" + b + "_cf_display][valuetype=" + c + "]").text(d.val()); if (d.val() != "No Date") { $("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val(d.val()) } } else { if (c == "Flag") { if (d[0].children.length > 0 && d[0].children[0].checked) { $("#" + a).find("[class=" + b + "_cf_display][valuetype=" + c + "]").text("Yes"); $("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val("True") } if (d[0].children.length > 0 && d[0].children[1].checked) { $("#" + a).find("[class=" + b + "_cf_display][valuetype=" + c + "]").text("No"); $("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val("False") } } else { if (c == "Lookup") { if (d.find("option:selected").length > 0 && d.find("option:selected").val() != "") { $("#" + a).find("[class=" + b + "][valuetype = Lookupid]").val(d.find("option:selected").val()) } $("#" + a).find("[class=" + b + "][valuetype = Lookupvalue]").val(d.find("option:selected").text()); $("#" + a).find("[class=" + b + "_cf_display][valuetype=" + c + "]").text(d.find("option:selected").text()) } else { $("#" + a).find("[class=" + b + "_cf_display][valuetype=" + c + "]").text(d.val()); $("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val(d.val()) } } } }) } function TSM_ensurePositive() { $(".positive").each(function () { var a = MvcControlsToolkit_TypedTextBox_Get(this, MvcControlsToolkit_DataType_UInt); if (a != null && a < 0) { MvcControlsToolkit_TypedTextBox_Set(this, 0, "", MvcControlsToolkit_DataType_UInt) } if (a != null && $(this).hasClass("dayTime") && a > 24) { MvcControlsToolkit_TypedTextBox_Set(this, 24, "", MvcControlsToolkit_DataType_UInt) } }) } function TSM_DeleteRow() { var a = $("#basedetail").data("chosen-row"); a = a.replace("_remove", ""); $(".detailTB").each(function () { var c = $(this); var e = c.attr("id"); if ((c.attr("data-element-type") || "") != "") { e = e.substring(0, e.lastIndexOf("_")); c = $("#" + e) } tname = "#" + e.substring(0, e.length - 3) + "_Total_" + e.substring(e.length - 2, e.length - 1); var b; if (!isNaN(parseFloat(c.val()))) { b = parseFloat(c.val()) } else { b = 0 } var d; var f; if (e.indexOf("plh") == -1 && e.indexOf("DayTime") != -1) { if (!isNaN(parseFloat($(tname).text()))) { d = parseFloat($(tname).text()) } else { d = 0 } if (!isNaN(parseFloat($("#allTotal").text()))) { f = parseFloat($("#allTotal").text()) } else { f = 0 } var g = TSM_GetRowValue(e, a, c.val()); if (!isNaN(parseFloat(g))) { $(tname).text((d - parseFloat(g)).toFixed(2)); $("#allTotal").text((f - parseFloat(g)).toFixed(2)) } } }); $("#" + a.replace("_remove", "") + "_Container").remove(); TSM_formDirty(true) } function TSM_CopyFromRow(a) { $(".detailBoolean").each(function () { var b = $(this); var c = b.attr("id"); b.prop("checked", $("#" + a + "_" + c).val() == "True") }); $(".descriptiveDetail").each(function () { var b = $(this); var c = b.attr("id"); b.text($("#" + a + "_" + c).text()) }); $(".detailTB").each(function () { var d = $(this); var c = d.attr("id"); if ((d.attr("data-element-type") || "") != "") { c = c.substring(0, c.lastIndexOf("_")); d = $("#" + c); if ($("#" + a + "_" + c).val() == 0) { MvcControlsToolkit_TypedTextBox_SetString(this, "") } else { MvcControlsToolkit_TypedTextBox_SetString(this, $("#" + a + "_" + c).val()) } $(this).trigger("pblur") } else { var f = $("#" + a + "_" + c).val(); d.val(f); var b = $("#" + this.id + "_display"); var e = b.attr("data-format") || null; if (e != null) { e = $.parseJSON(e); f = MvcControlsToolkit_Parse(f, e.type); f = MvcControlsToolkit_FormatDisplay(f, e.format, e.type, e.prefix, e.postfix, e.nullstring) } b.text(f) } }); $("#" + a).find("[class=datatype]").each(function () { var c = $(this).val(); var b = $(this).attr("field"); if (b == "Lookup") { b = $(this).attr("lookuptable"); c = "Lookup" } $(".detailTBCS[name=" + b + "]").each(function () { var d = $(this); d.hide(); if (d.attr("class").indexOf(c) >= 0) { if (c == "Date") { if ($("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val() != "") { d.val($("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val().split(" ")[0]) } else { d.val("No Date") } } else { if (c == "Flag") { if ($("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val() == "True") { d[0].children[0].checked = true; d[0].children[1].checked = false } else { if ($("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val() == "False") { d[0].children[0].checked = false; d[0].children[1].checked = true } else { if ($("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val() == "") { d[0].children[0].checked = false; d[0].children[1].checked = false } } } } else { if (c == "Lookup") { d.html($("#" + a).find("." + b + "_display").html()); if ($("#" + a).find("[class=" + b + "][valuetype=Lookupid]").val() != undefined && $("#" + a).find("[class=" + b + "][valuetype=Lookupid]").val() != "") { $("." + b + "lkp").val($("#" + a).find("[class=" + b + "][valuetype=Lookupid]").val()) } } else { d.val($("#" + a).find("[class=" + b + "][valuetype=" + c + "]").val()) } } } d.show() } else { d.empty() } }) }) } function reload() { TSM.initPreloader("show"); window.location.href = window.location.href } function GotoUrl(a) { TSM.initPreloader("show"); window.location.href = a } function TSM_ConfirmApproveTimesheet(a) { if (a) { TSM_CopySummary(true, a.ErrorMessage); OpenDialog("#tskupdateSummary") } } function EnableApprove(a) { if ($(".TimesheetId").is(":checked") || $(".TaskId").is(":checked")) { $(".approvals").removeClass("ui-disabled") } else { $(".approvals").addClass("ui-disabled") } $("#" + a).children(".selectedtimeappr:first").val($("#" + a).children(".TimesheetId:first").is(":checked")); $("#" + a).children(".selectedtaskappr:first").val($("#" + a).children(".TaskId:first").is(":checked")) } function EnableTaskApprove(a) { if ($(".taskapprovals").is(":checked")) { $(".tskbtns").removeClass("ui-disabled") } else { $(".tskbtns").addClass("ui-disabled") } } function ApproveRejectSelectedTimesheets(mode) { var jForm = $("#approvalform"); TSM.initPreloader("show"); $.post(jForm.attr("data-ajax-url") + "/?mode=" + mode, jForm.serialize(), function (data) { var onComplete = jForm.attr("data-ajax-oncomplete") || null; if (onComplete != null) { onComplete = eval(onComplete); onComplete(data) } TSM.initPreloader("hide") }) } function ApproveRejectTimesheet(mode) { var jForm = $("#approvalform"); TSM.initPreloader("show"); $.post(jForm.attr("data-ajax-url") + "/?mode=" + mode, jForm.serialize(), function (data) { var onComplete = jForm.attr("data-ajax-oncomplete") || null; if (onComplete != null) { onComplete = eval(onComplete); onComplete(data) } TSM.initPreloader("hide") }) } function ApproveSelectedTasks(a) { var e = $("#approvalform"); TSM.initPreloader("show"); var c = new Array(); var d = 0; $(".taskapprovals").each(function () { if ($(this).is(":checked")) { c[d] = $(this).attr("data-row-from"); d++ } }); var b = JSON.stringify(c); $.ajax({ cache: false, type: "POST", url: e.attr("data-ajax-url"), async: "false", contentType: "application/json", data: JSON.stringify({ assignments: c, mode: a }), success: function (f) { TSM_ConfirmApproveTimesheet(f); TSM.initPreloader("hide") } }) } function TSM_CopySummary(b, e) { if (e) { $(".updateerrormessage-d").text(e) } else { $(".updateerrormessage-d").text($(".updateerrormessage").val() || "") } if (!b) { $(".currstatus-d").text($(".currstatus").val() || ""); $(".currcomments-d").text($(".currcomments").val() || ""); $(".currname-d").text($(".currname").val() || ""); var a; var d; var c; c = $(".currtotalact").val(); a = $(".currtotalact-d"); d = a.attr("data-format") || null; d = $.parseJSON(d); c = MvcControlsToolkit_Parse(c, d.type); c = MvcControlsToolkit_FormatDisplay(c, d.format, d.type, d.prefix || "", d.postfix || "", d.nullstring || ""); a.text(c); c = $(".currtotalovertime").val(); a = $(".currtotalovertime-d"); d = a.attr("data-format") || null; d = $.parseJSON(d); c = MvcControlsToolkit_Parse(c, d.type); c = MvcControlsToolkit_FormatDisplay(c, d.format, d.type, d.prefix || "", d.postfix || "", d.nullstring || ""); a.text(c); c = $(".currtotalnonbill").val(); a = $(".currtotalnonbill-d"); d = a.attr("data-format") || null; d = $.parseJSON(d); c = MvcControlsToolkit_Parse(c, d.type); c = MvcControlsToolkit_FormatDisplay(c, d.format, d.type, d.prefix || "", d.postfix || "", d.nullstring || ""); a.text(c); c = $(".currtotalovertimenonbill").val(); a = $(".currtotalovertimenonbill-d"); d = a.attr("data-format") || null; d = $.parseJSON(d); c = MvcControlsToolkit_Parse(c, d.type); c = MvcControlsToolkit_FormatDisplay(c, d.format, d.type, d.prefix || "", d.postfix || "", d.nullstring || ""); a.text(c) } } function daysBetween(a, f) { var e = new Date(a); var h = new Date(f); var g = new Date(e.getFullYear(), e.getMonth(), e.getDate()); var d = new Date(h.getFullYear(), h.getMonth(), h.getDate()); var i = 1000 * 60 * 60 * 24; var b = d.getTime() - g.getTime(); var c = b / i; return Math.floor(c) + 1 } function TSM_PrepareDays(d, j) { var g = $("#dayTemplate"); var b = $("#dayHdrTemplate"); if (g.length == 0) { return } var n = g.data("oldStart") || ""; var m = g.data("olddur") || ""; if (d == "" || j == "" || d == undefined || j == undefined) { return } var e = daysBetween(d, j); if ((d == n && e == m)) { return } var k = $("#dayTemplate").html(); var h = $("#dayHdrTemplate").html(); g.empty(); b.empty(); var f = ""; var a = ""; var c = MvcControlsToolkit_Parse(d, MvcControlsToolkit_DataType_DateTime); var l = c; var o = 0; while (o < e) { var p = MvcControlsToolkit_Format(l, "ddd MM/dd", MvcControlsToolkit_DataType_DateTime, "", " "); a = a + h.replace(/_p1lh_/g, p); f = f + k.replace(/_plh_/g, o + ""); o++; l = new Date(l.getFullYear(), l.getMonth(), l.getDate() + 1) } g.html(f); b.html(a); $(document).ready(function () { g.find("input:text").focus(function () { $(this).select() }) }); g.data("oldStart", d); g.data("olddur", e) } MvcControlsToolkit_ParseRegister.add(function (a) { if (a != "#dayContainer") { $(a).trigger("create") } }, false); $.validator.setDefaults({ ignore: "" });